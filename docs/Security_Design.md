# 🛡 Tickwise セキュリティ設計：論理の「鋼」を、投資の「盾」に

Rust製投資分析ツール「Tickwise」は、その核に「想定されるあらゆるセキュリティの配慮」を携えています。私たちが大切にしたのは、投資家にとって柔軟かつ信頼できるツールであること。データの安全性、計算の一貫性、エラーに強い可用性――これらすべての要件に妥協することなく、情熱を注ぎ込みました。

一般的には「CIA（機密性・完全性・可用性）」の順で語られますが、Tickwiseはあえてその順序を入れ替え、**「ICA」**として定義します。なぜなら、投資家にとって最も価値があるのは、何者にも汚染されない**「情報の正確性（Integrity）」**だと信じているからです。

---

## 1. 完全性（Integrity）：不変の真実（SOT）を守り抜く
Tickwiseを支えるバックボーン、それはデータ一貫性維持のための**単一の信頼可能な情報源（SOT: Source of Truth）**哲学です。

#### ● 専用ラッパー `TechnicalDataGuard` による厳格なアクセス制御
投資指標データのあらゆる操作は、専用のラッパー構造体 `TechnicalDataGuard` を通じて行われます。
- **直接アクセスの禁則化:** 「真の構造体」への直接的な読み書きをエンジニアリングレベルで禁止。必ずガード（ラッパー）を経由することを強制し、コーディングにおける不用意なバグやデータ破壊を構造的に抑え込んでいます。
- **処理系に応じた制御:** 処理系に合わせて厳選されたリード/ライト用のインターフェースのみを提供し、データの整合性を鉄壁の守りで担保します。

#### ● 単一実行と標準ライブラリによる「ブレ」の排除
計算結果の信頼性を極限まで高めるため、以下の設計を採用しています。
- **一回限りの計算実行:** 各指標の計算はプログラムのライフサイクル中で**一度きり**しか行われません。重複した計算ロジックを排除することで、画面表示、ログ、LLMプロンプトのすべてにおいて、寸分違わぬ同一の数値を供給します。
- **標準ライブラリ `ta` クレートの採用:** コア演算にはRustの業界標準である `ta` クレートを採用。**オリジナルの計算処理を極力抑える**ことで、独自実装に伴う潜在的なバグを排除し、検証済みのアルゴリズムによる確かな結果を保証します。
- **精度の統一:** すべての演算は `f64` に完全統一。型変換に伴う微細な精度の欠落さえも許容しません。
- **市場コンテキストの同期:** 取引所の更新時刻を考慮したデータ取得ロジックを搭載。データ鮮度に対する厳格な管理により、常に「今、意味のある事実」のみを扱います。

> 各指標の具体的な算出ロジックと解説については、以下のガイドを参照してください。
> 👉 [indicator-guide.md](./indicator-guide.md)

---

## 2. 機密性（Confidentiality）：資産の死守とシステムへの誠実さ
「利用者のシステムを侵害しないこと」と「APIキーをメモリ上に放置しないこと」を徹底しています。

#### ● OS上の一メンバーとしての誠実さ（Rustの力）
- **Rust採用の理由:** OS上で動作する一プログラムとして、システム全体に如何なるリスクも与えないことを追求しました。Rustはメモリリークやセグメンテーションフォルトを根本から排除する言語です。型システムによりデータの安全な受け渡しを保証し、システム資源を侵害しない「クリーンな実行」を約束します。
- **境界サニタイズの徹底:** ファイル、ティッカー、クエリ等、外部入力が通過するすべての境界線で、不正文字や過長データを検知・無効化。OSへの影響を入り口で遮断します。

#### ● 資産価値としての API キー：極小露出とゼロパディング
APIキーは金銭的価値を持つ資産です。その露出時間を極限まで削ぎ落とす工夫を施しています。
- **オンデマンド展開:** キーは常時メモリに展開せず、APIリクエストを構築する直前にのみ最小限のスコープで読み込みます。
- **直後のゼロパディング廃棄:** 利用後はただちにメモリ上で **ゼロパディング（0埋め）** を行い廃棄。ロジックの他所からキーを追跡・出力することを物理的に不可能にしています。
- **露出の構造的ブロック:** ログや内部構造体からキーを排除。`--debug-args` 等の表示時もマスク処理を徹底しています。

#### ● ソフトウェア・サプライチェーンの透明性
####  サプライチェーン・リスクの低減 (`cargo audit`)
依存ライブラリに潜む既知の脆弱性リスクを管理するため、RustSec アドバイザリデータベースを用いたスキャンを開発工程に組み込んでいます。

- **継続的な検証**: 全依存ライブラリ（現時点で 240 以上）に対し、定期的に `cargo audit` を実行。既知の脆弱性が報告された場合は、速やかなアップデートまたは代替ライブラリへの検討を行う運用を目指しています。
- **スキャン結果の公開**: 開発時点でのスキャン結果を公開することで、依存関係の透明性を確保しています。

```text
(開発環境での実行例)
Scanning Cargo.lock for vulnerabilities (243 crate dependencies)
Success: No vulnerabilities found.
```

#### SBOM (Software Bill of Materials) の提供

- CycloneDX形式でのSBOM生成をサポートし、使用している全コンポーネントの透明性を確保しています。
---

## 3. 可用性（Availability）：止まらない論理、揺るがない信頼
ツールが動かなければ、いかに優れたロジックも価値を持ちません。

#### ● 異常終了（Crash）の完全排除
- **`unwrap` の完全排除:** すべてのエラーチェックを構造化。異常終了という「逃げ」を自分たちに禁じ、不安定な環境下でも安全に処理を継続または終了する堅牢さを実現しました。
- **レジリエンス:** APIの欠落や設定不備に対しても、指標データを提供する安全なデフォルト動作を定義。ユーザーの思考を止めない可用性を発揮します。

---

## 設計の思い
Tickwiseには「想定されるあらゆるセキュリティの配慮」が施されています。

計算の唯一性、標準ライブラリへの依拠、Rustによるシステム保護、そしてAPIキーのゼロパディング廃棄。これらすべては、ユーザーがどんな環境でも自信を持って利用できるための「約束」です。

**「壊れない、嘘をつかない、漏らさない。」**
この極当たり前のことを最高水準で追求し続けること。それが Tickwise のアイデンティティです。