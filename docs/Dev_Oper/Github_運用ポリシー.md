# Tickwise GitHub運用ポリシー

## 1. 理念
- 安全性：誤操作・履歴破壊・秘密露出を仕組みで防ぐ
- 透明性：誰が・いつ・何を変えたかが常に追跡できる
- 再現性：人が変わっても同じ結果になる（属人化しない）
- 単一路線：例外や口頭裁量で運用を揺らさない
- 最小差分：小さく速く安全に（小さな PR を積む）

---

## 2. 用語／略語（この文書での意味を固定）

### 2.1 日本語用語（五十音順｜定義のみ）
- 合図：進行の状態変化を相手に明確に伝える記述。ここでは PR のラベル更新と PR コメントでのメンション。
- 影響範囲：変更が及ぶ対象・箇所・関係者のまとまり（直接影響と副次影響を含む）。
- 受入基準：Issue／PR を完了とみなす条件の文章（期待動作・確認観点・除外範囲を含む）。
- 互換性注意：既存の利用やデータに調整・移行が必要となる点を明示する注意書き。
- 期日：その作業に対して合意された締切。
- 可視化：進行・順番・状態を誰でも同じ場所で確認できる形に置くこと（例：ラベル、キュー一覧）。
- 競合：自動では統合できない差分衝突の状態。
- コードオーナー：パスごとの責任レビュアーの定義。
- コミットID：変更の識別子（SHA）。
- コミット作成日時：コミットが作成された時刻（参考）。
- コミット取り込み日時：コミットが履歴に取り込まれた時刻（判断の拠り所）。
- 下書きプルリクエスト：作成途中の PR（進行の見える化に使う）。
- 小さなPR：小さな差分単位で提出するという考え方の呼称（具体閾値はプロジェクト定義に準じる）。
- 承認：レビュアーが取り込み可と判断した状態。
- 承認失効：新規コミットの追加やベース取り込みなどで既存承認が無効扱いになった状態。
- 修正要求：レビュアーが修正を求めている状態。
- 重要変更：ユーザー・運用・コスト・セキュリティ・互換性などに顕著な影響を与え得る変更の総称。
- 生成物：ソースから再生成できる出力物の総称（ビルド、バイナリ、ログ、キャッシュ等）。
- タグ／リリース：ある時点の状態を指し示すための印・配布単位。
- 大容量ファイル管理：大きなバイナリ資産を別管理する仕組み（Git LFS の概念）。
- チェリーピック：特定のコミットだけを別ブランチへ取り込む操作。
- 定義済みチェック：リポジトリ設定で必須に指定された自動検査の集合（内容はプロジェクト定義に準じる）。
- 統合コミット方式：統合専用のコミットを作って取り込む方式（Merge Commit の概念）。
- 取り込み順一覧：取り込み待ち PR の順序と現在地を一覧化して公開する場（Merge Queue の概念）。
- 分割：変更を目的ごとの意味単位で複数 PR に切り分けること。
- 復旧：望ましくない取り込みを安全に元の状態へ戻す行為（Revert 中心）。
- ブランチ更新：ベースブランチ（例：main）の内容を PR ブランチに取り込む操作の総称（UI 操作の概念）。
- 保護ブランチ：直 push・強制 push・削除などを設定で制限したブランチ。
- マージ準備完了：PR が取り込み可能な状態に整ったこと（承認有効・必須チェック成功・追加差分予定なし等）。
- ラベル：PR の状態・阻害要因・優先度・種別を示す印（名称体系）。
- リベース：作業ブランチの履歴を並べ替えて最新のベースに追随させる操作。
- リモートメイン：サーバ上の main（基準として参照する先端）。
- ローリング鍵更新：秘密鍵を失効させ新しい鍵へ切り替える手続き（Token Rotation の概念）。
- ローカルメイン：手元にある main の参照（origin/main と区別する呼称）。
- 行単位履歴：各行を最後に誰がいつ更新したかの記録（Blame）。
- 最新コミット：直近で取り込まれたコミット。
- 秘密検知：秘密情報の混入を自動で見つける仕組み。
- 秘密情報：API キー、トークン等の公開してはならない情報。
- 秘密混入：PR／リポジトリに秘密情報が含まれてしまう状態、またはその疑い。
- プルリクエスト：変更を main に取り込むための申請単位（説明・議論・合意の入れ物）。
- メイン：常に動作可能な“正”のブランチ（本文では main と表記）。
- リセット：参照先を過去に付け替える操作（共有履歴を書き換え得る性質）。
- リバート：取り込まれた変更を打ち消す新しいコミットで元に戻す操作（履歴は保持）。
- リバートPR：リバートだけを含む PR（対象の PR 番号やコミットを明記）。
- 履歴書き換え：共有ブランチの過去コミットを書き換える行為の総称。
- 連続統合：テストや静的解析などを自動で実行する仕組み（CI の概念）。
- 優先度：PR／Issue の処理の緊急度・重要度を表す概念。
- 完了条件：PR を終わったとみなす到達点の文章（取り込み・関連クローズ・記録更新の完了）。

### 2.2 英語用語（A–Z｜定義のみ）
- .env：環境変数を記載するファイル種別（Secret を含みうる入れ物）。
- Approval：レビュアーが取り込み可と判断した状態。
- Artifacts：ソースから再生成できる出力物（ビルド結果・バイナリ・ログ・キャッシュ等）。
- Authored Date：コミットが作成された日時（参考情報）。
- Blame：各行の最終更新者と更新時刻を示す表示。
- blocked:ci-failed：必須チェック（CI）失敗により PR の進行が止まっていることを示すラベル。
- blocked:needs-rebase：ベースへの追随（rebase）が必要で PR の進行が止まっていることを示すラベル。
- CHANGELOG：重要変更や互換性注意を人向けに要約した記録。
- Cherry-pick：特定コミットのみを別ブランチへ取り込む操作。
- CI (Continuous Integration)：テストや静的解析などを自動実行する仕組み。
- CODEOWNERS：パスごとの責任レビュアーを定義する仕組み。
- Commit / SHA：変更の単位／その一意識別子。
- Committed Date：コミットが履歴に取り込まれた日時。
- Definition of Done：PR を完了とみなす到達点を定義した文書。
- Definition of Ready：Issue／PR が着手可能とみなせる条件を定義した文書。
- Draft Pull Request：作成途中の Pull Request（進行の見える化に用いる器）。
- Fast-Forward：分岐がない場合に先端参照だけを進めて取り込む方式。
- Feature branch：main から分岐する短期の作業用ブランチ。
- File History：特定ファイルに関与したコミットの時系列。
- Force Push：共有履歴を書き換え得る push の総称。
- Git LFS：大容量ファイルを別管理する仕組み。
- History Rewrite：共有ブランチの過去コミットを書き換える行為の総称。
- Labels：PR の状態・阻害要因・優先度・種別を示す名称群。
- Latest Commit：直近で取り込まれたコミット。
- Linear History：履歴を直線に保つ方針。
- local main：ローカルの main 参照（origin/main と区別する呼称）。
- main：常に動作可能な“正”のブランチ。
- Merge Commit：統合専用のコミットを作って取り込む方式。
- Merge Conflict：自動統合できない差分衝突の状態。
- Merge Queue：取り込み待ち PR の順序と現在地を一覧化して公開する場。
- origin/main：サーバ上の main（基準として参照する先端）。
- PR Template：PR 本文の必須項目を定めた雛形。
- priority:high：高い優先度を示すラベル。
- priority:normal：標準の優先度を示すラベル。
- priority:low：低い優先度を示すラベル。
- Protected Branch：直 push・強制 push・削除などを設定で制限したブランチ。
- Pull Request (PR)：変更を main に取り込むための申請単位。
- Rebase：作業ブランチを main 最新に追随させるための履歴並べ替え。
- Release / Tag：ある時点の状態を指し示す印・配布単位。
- Request Changes：レビュアーが修正を求めている状態。
- Required Status Checks：リポジトリ設定で必須に指定された自動検査の集合名（内容はプロジェクト定義に準じる）。
- Reset：参照先の付け替え（共有履歴では使用禁止の性質）。
- Revert：打ち消しコミットを追加して元に戻す操作（履歴は保持）。
- Revert Pull Request：Revert だけを含む PR（対象 PR 番号やコミットを明記）。
- Rollback：本ポリシーでは Revert と同義。
- Secret：公開不可の鍵・トークン等。
- Secret Scanning：Secret 混入を自動検知する仕組み。
- SLA (Service Level Agreement)：対応時間に関する取り決め（具体値はプロジェクト定義に準じる）。
- Small PR：小さな差分単位で提出するという考え方の呼称（具体閾値はプロジェクト定義に準じる）。
- Squash Merge：PR 内の複数コミットを 1 つにまとめて取り込む方式。
- Stale Approval：新規コミット追加やベース取り込みで既存承認が無効扱いになった状態。
- status:approved：承認済みを示すラベル。
- status:changes-requested：修正対応中を示すラベル。
- status:draft：作成中を示すラベル。
- status:merge-ready：管理者マージ待ちを示すラベル。
- status:ready-for-review：レビュー依頼中を示すラベル。
- Token Rotation：秘密鍵の失効と再発行の手続き。
- type:chore：雑務・機械的変更の種別ラベル。
- type:docs：文書変更の種別ラベル。
- type:feature：機能追加の種別ラベル。
- type:fix：不具合修正の種別ラベル。
- Update Branch：ベースブランチ（例：main）の内容を PR ブランチに取り込む UI 操作の総称。

---

## 3. 役割と責務
- 管理者（Maintainer）：main の保護維持、レビュー体制整備、キュー管理、Squash & Merge 実施、事故時の Revert PR 主導。
- 開発者（Contributor）：feature → PR でのみ作業（main は触らない）。説明・テスト・スクショを揃える。必要に応じ自分ブランチを最新化。
- レビュアー（Reviewer）：目的・影響・安全（秘密/権限）・テスト観点でレビュー。基準未満（巨大 PR、説明不足、CI 失敗、秘密混入）は差し戻し。

---

## 4. 運用ルール

### 必須（MUST）
- main は読み取り専用。変更は PR 経由のみ。
- Squash Merge のみを使用（Fast-Forward／Merge Commit は使用しない）。
- 承認＋必須チェックでマージ可。承認は CODEOWNERS 該当者によるものとし、必要承認数と必須チェック名はプロジェクト定義に準じる。
- 小さな PR で提出する（具体的なファイル数・差分行数の閾値はプロジェクト定義に準じる）。
- PR 本文に 目的／背景／変更点／影響／テスト手順 を明記し、Issue へ紐付け。
- 秘密情報・生成物は PR に含めない。

### 推奨（SHOULD）
- feature ブランチは短命（マージ後は削除）。
- ブランチ追随は Rebase を用い、履歴を清潔に保つ（GitHub の Update branch は使用しない）。
- 本ポリシーの変更は本ファイルへの PR のみ（口頭例外は禁止）。

### SLA（対応時間）
- プロジェクト定義に準じる。

### 禁止（NG）
- main 直 push／強制 push／削除／保護解除。
- Zip 配布・Zip から作業開始（履歴欠落）。
- 巨大 PR・説明不足 PR・CI 失敗のままのマージ。
- DM（ダイレクトメッセージ）での合意・承認（PR 外は無効）。

---

## 5. 運用フロー

合図の原則：合図は PR コメントのメンション と ラベル更新 だけ。DM は無効。

### 5-1. 企画〜着手可（Issue）
- 管理者：Issue を整備（目的・背景・受入基準・影響・優先度・期日）。担当開発者とレビュアーを指名。必要に応じ小 PR 単位に分割。合図：Issue に「開始可」を明記。
- 開発者：不明点は Issue で質問し文章で確定。Draft PR を作成して Issue へリンク。
- レビュアー：担当範囲を確認し、レビュー観点（仕様・セキュリティ・テスト）を準備。

Definition of Ready：受入基準が確定／影響範囲が見える／小 PR 単位／担当・レビュアー・期日が決定。

### 5-2. PR ライフサイクル
- status:draft（作成中） — 主語：開発者  
  PR 本文を整備（目的／背景／変更点／影響／テスト手順）。自己テスト・スクショを添付。小 PR に収める。  
  合図：準備完了 → status:ready-for-review に変更し、レビュアーをメンション。

- status:ready-for-review（レビュー依頼中） — 主語：レビュアー  
  確認：目的・影響・秘密/生成物なし・CI 成功・差分サイズ。  
  判定：問題なし→承認（status:approved）。問題あり→具体指摘＋ status:changes-requested。  
  注意：依頼後に仕様追加をしない（差分膨張は失格）。

- status:changes-requested（修正対応中） — 主語：開発者  
  指摘へ PR 上で返信し、必要最小の修正を追加。  
  blocked:needs-rebase（追随必要）や blocked:ci-failed（CI 失敗）は開発者が解消。  
  合図：修正完了 → status:ready-for-review に戻して再依頼。

- status:approved（承認済み） — 主語：開発者 → 管理者  
  開発者は追加コミットを止める（承認は追加差分で失効）。本文チェック項目を最終確認。  
  引き渡し：status:merge-ready に変更し、PR コメントで @maintainers を明示。

- status:merge-ready（管理者マージ待ち） — 主語：管理者  
  受領コメントを残し、承認有効・CI 成功・不要追加なしを確認して Squash & Merge。  
  可視化：処理順は固定の Merge Queue Issue に   
  Auto-merge は使用しない。

- Merged（取り込み完了） — 主語：管理者 → 開発者  
  管理者：PR を閉じ、ブランチ削除（自動設定可）。  
  開発者：紐づく Issue をクローズ。必要ドキュメントや CHANGELOG を更新。

Definition of Done：Squash & Merge 済み／Issue クローズ／関連ドキュメント更新／リリース影響を記録。

### 5-3. ブロック時の扱い（共通）
- blocked:needs-rebase：開発者が追随して解消 → status:ready-for-review へ復帰。
- blocked:ci-failed：開発者が原因を PR に明記し再実行、成功後に復帰。
- 禁止：古い承認のままのマージ（stale approval）、巨大 PR、秘密・生成物の混入。

---

## 6. 履歴と日付の見方（判断の拠り所）
- 判断は Committed Date を正（Authored Date は参考）。
- 仕様の発効時点＝PR のマージ時刻。
- ファイルの最終更新＝ File History、行単位＝ Blame。
- 「最近の動き」＝リポジトリの Latest commit と PR 一覧の更新順。
- Zip のタイムスタンプは無効（履歴がないため）。

---

## 7. 秘密・生成物・安全
- Secret と生成物はコミットしない。混入の疑いがある PR は無条件差し戻し。
- 事故時：Revert PR → 秘密無効化/再発行（Token Rotation）→ 影響共有 → 再発防止の更新。

---

## 8. 事故対応（壊さない原則）
- main の誤取り込みは Revert PR で戻す（履歴は書き換えない）。
- Hotfix も PR 経由・Squash のみ。直 push は許容しない。
- 例外：公開済み Secret 混入が確認された場合に限り、鍵失効・影響調査のうえ、履歴除去（最終手段）を例外として許容。

---

## 9. 本ポリシーの改定
- 変更は本ファイルへの PR でのみ提案し、全員通知と管理者承認を必須。
- 口頭例外・一時運用は無効。
