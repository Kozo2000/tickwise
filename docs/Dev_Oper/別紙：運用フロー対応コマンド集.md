共通前提
＃対象者：全員
＃作業内容：リモートの最新取得と pull 挙動の固定
＃注意事項：git config pull.ff only は必須／HTTPSよりSSH推奨／local main は checkout しない

gh auth status
＃対象：全員
＃GH CLI のログイン確認（未ログインなら gh auth login）

git remote -v
＃対象：全員
＃origin の URL を確認（意図したリポジトリか／SSH 推奨）

git config pull.ff only
＃対象：全員
＃pull を Fast-Forward のみに固定（不要なマージコミット防止）
＃注意：個人設定が違っていたら必ず合わせる

git fetch --prune origin
＃対象：全員
＃リモート（origin）の最新を取得／不要な追跡ブランチを整理

git rev-parse --verify origin/main
＃対象：全員
＃origin/main が取得できているか検証（無ければ fetch を再確認）

5-1 企画〜着手可（Issue）
＃対象者：開発者
＃作業内容：feature ブランチ作成 → Draft PR 作成 → ラベル付与／Issue 連携
＃注意事項：ブランチ名は英数とハイフンのみ／秘密・生成物を含めない／local main は使わない

git switch -c feature/<issue-短名> origin/main
＃対象：開発者
＃origin/main を起点に作業ブランチを新規作成して切替

git push -u origin feature/<issue-短名>
＃対象：開発者
＃作業ブランチをリモートへ初回公開し追跡設定（-u）を結ぶ
＃注意：同名ブランチが既にある場合は中断して確認

gh pr create --draft --base main --head feature/<issue-短名> --fill
＃対象：開発者
＃main 向けの Draft PR を作成（PR テンプレ自動埋め）

gh pr edit --add-label "status:draft"
＃対象：開発者
＃状態ラベル：作成中

gh pr edit --add-label "type:<feature|fix|docs|chore>"
＃対象：開発者
＃種別ラベルを付与（いずれか一つ）

gh pr edit --add-label "priority:<high|normal|low>"
＃対象：開発者
＃優先度ラベルを付与（いずれか一つ）

gh pr comment -b "links: resolves #<issue-number>"
＃対象：開発者
＃対象 Issue とリンク（マージ時に自動クローズ）

5-2 PRライフサイクル — draft → ready-for-review
＃対象者：開発者
＃作業内容：差分作成 → PR をレビュー依頼状態へ
＃注意事項：最小差分でコミット／自己テストの証跡（スクショ等）を添付

git add -p
＃対象：開発者
＃必要最小の差分だけをステージ

git commit -m "<type>: <要約>"
＃対象：開発者
＃意味単位で履歴化（type は feature/fix/docs/chore）

git push
＃対象：開発者
＃PR に反映

gh pr ready
＃対象：開発者
＃Draft を通常 PR へ切替

gh pr edit --remove-label "status:draft"
＃対象：開発者
＃Draft ラベルを外す

gh pr edit --add-label "status:ready-for-review"
＃対象：開発者
＃レビュー依頼中ラベルを付与

gh pr edit --add-reviewer <github-id-1> --add-reviewer <github-id-2>
＃対象：開発者
＃レビュアーを指名

gh pr comment -b "@<reviewer1> @<reviewer2> レビューお願いします"
＃対象：開発者
＃メンションで依頼を明示

5-2 PRライフサイクル — ready-for-review（判定）
＃対象者：レビュアー
＃作業内容：承認 or 修正要求の判定
＃注意事項：CI 成功／秘密・生成物なし／差分過大は差し戻し

gh pr checks --watch
＃対象：レビュアー
＃必須チェック（CI 等）の状況を確認

gh pr review --approve -b "LGTM"
＃対象：レビュアー
＃承認を付与

gh pr edit --add-label "status:approved"
＃対象：レビュアー
＃承認済みラベルを付与

gh pr edit --remove-label "status:ready-for-review"
＃対象：レビュアー
＃レビュー依頼中ラベルを除去

gh pr review --request-changes -b "<修正理由>"
＃対象：レビュアー
＃（代替）修正要求を記録

gh pr edit --add-label "status:changes-requested"
＃対象：レビュアー
＃修正対応中ラベルを付与

gh pr edit --remove-label "status:ready-for-review"
＃対象：レビュアー
＃レビュー依頼中ラベルを除去

5-2 PRライフサイクル — changes-requested 対応
＃対象者：開発者
＃作業内容：指摘の最小修正を反映し再依頼
＃注意事項：不要な仕様追加を混ぜない／差分は小さく

git status
＃対象：開発者
＃作業ツリーとステージの状態確認

git add -p
＃対象：開発者
＃修正分のみステージ

git commit -m "fix: <内容>"
＃対象：開発者
＃修正意図を明確化

git push
＃対象：開発者
＃PR へ反映

gh pr edit --remove-label "status:changes-requested"
＃対象：開発者
＃修正対応中ラベルを外す

gh pr edit --add-label "status:ready-for-review"
＃対象：開発者
＃再レビュー依頼中ラベルを付与

gh pr comment -b "指摘対応しました。再レビューお願いします"
＃対象：開発者
＃合図をコメントで残す

5-2 PRライフサイクル — approved → merge-ready 引き渡し
＃対象者：開発者
＃作業内容：管理者のマージ待ちへ移行
＃注意事項：承認失効させる追加コミットを止める／CI 緑を維持

gh pr edit --add-label "status:merge-ready"
＃対象：開発者
＃管理者マージ待ちラベルを付与

gh pr edit --remove-label "status:approved"
＃対象：開発者
＃承認済みラベルを外す

gh pr comment -b "@maintainers merge ready"
＃対象：開発者
＃管理者へ引き渡し合図

5-2 PRライフサイクル — merge-ready の処理（マージ）
＃対象者：管理者
＃作業内容：Squash & Merge／処理順の公開／ブランチ削除
＃注意事項：Auto-merge は使わない／承認・CI の有効性を再確認

gh issue comment <queue-issue-number> -b "queued: #<pr-number>"
＃対象：管理者
＃マージ順をキュー Issue に記録（可視化）

gh pr merge --squash --delete-branch <pr-number>
＃対象：管理者
＃Squash で取り込み、PR ブランチを削除

gh issue comment <queue-issue-number> -b "merged: #<pr-number>"
＃対象：管理者
＃完了をキュー Issue に記録

5-2 PRライフサイクル — Merged 後処理
＃対象者：管理者・開発者
＃作業内容：関連 Issue クローズ／必要ドキュメント更新
＃注意事項：CHANGELOG 運用がある場合のみ更新 PR を切る

gh issue close <issue-number>
＃対象：管理者
＃関連 Issue をクローズ（PR で自動クローズ済みなら不要）

git fetch origin
＃対象：開発者
＃最新を取得

git switch -c docs/changelog origin/main
＃対象：開発者
＃ドキュメント更新用の短期ブランチ作成

git add CHANGELOG.md
＃対象：開発者
＃変更履歴の更新をステージ

git commit -m "docs(changelog): update for #<pr-number>"
＃対象：開発者
＃変更履歴更新のコミット

git push -u origin docs/changelog
＃対象：開発者
＃ブランチを公開し追跡設定

gh pr create --base main --head docs/changelog --title "Update CHANGELOG" --fill
＃対象：開発者
＃CHANGELOG 更新の PR を作成

5-3 ブロック時の扱い — blocked:needs-rebase
＃対象者：開発者
＃作業内容：main 進行に追随し競合を解消
＃注意事項：push は --force-with-lease を必ず使用（他者更新保護）

git fetch origin
＃対象：開発者
＃最新 main を取得

git rebase origin/main
＃対象：開発者
＃自ブランチを最新 main 上に並べ替え

git add <解消したファイル>
＃対象：開発者
＃競合解消結果を登録

git rebase --continue
＃対象：開発者
＃リベースを継続

git push --force-with-lease
＃対象：開発者
＃安全確認付きで履歴を更新

gh pr edit --remove-label "blocked:needs-rebase"
＃対象：開発者
＃ブロック解除を明示

5-3 ブロック時の扱い — blocked:ci-failed
＃対象者：開発者
＃作業内容：失敗ジョブの原因特定と修正
＃注意事項：失敗理由と対策を PR コメントに残す

gh pr checks
＃対象：開発者
＃現在のチェック状況を一覧

gh run list --branch feature/<issue-短名>
＃対象：開発者
＃実行履歴を一覧

gh run view <run-id> --log
＃対象：開発者
＃失敗ジョブの詳細ログを確認

git add -p
＃対象：開発者
＃修正分のみステージ

git commit -m "ci: fix <内容>"
＃対象：開発者
＃CI 修正コミットを作成

git push
＃対象：開発者
＃修正を送信し CI を再実行

gh pr edit --remove-label "blocked:ci-failed"
＃対象：開発者
＃成功後にブロック解除を明示

事故対応 — Revert PR
＃対象者：管理者（または指示された開発者）
＃作業内容：main の誤取り込みを履歴を書き換えずに取り消す
＃注意事項：複数コミットなら対象を特定／秘密露出時は鍵の失効・再発行を並行

git fetch origin
＃対象：管理者
＃最新 main を取得

git switch -c revert/<short-sha> origin/main
＃対象：管理者
＃取り消し用ブランチを main 上に作成

git revert <short-sha>
＃対象：管理者
＃指定コミットを打ち消すコミットを作成

git push -u origin revert/<short-sha>
＃対象：管理者
＃リモートへ公開し追跡設定

gh pr create --base main --head revert/<short-sha> --title "Revert: <元タイトル>" --body "Reverts #<pr-number>"
＃対象：管理者
＃Revert 専用 PR を作成

gh pr edit --add-label "type:fix"
＃対象：管理者
＃種別ラベル

gh pr edit --add-label "priority:high"
＃対象：管理者
＃優先度ラベル（高）